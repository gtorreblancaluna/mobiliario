<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="reporte_por_categorias" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="d16cf63b-3404-463d-935c-2e064e5dbd9b">
	<property name="ireport.zoom" value="1.331000000000018"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="USUARIO_ID" class="java.lang.String"/>
	<parameter name="RENTA_ID" class="java.lang.String"/>
	<parameter name="URL_IMAGEN" class="java.lang.String"/>
	<parameter name="NOMBRE_ENCARGADO_AREA" class="java.lang.String"/>
	<parameter name="NOMBRE_CLIENTE" class="java.lang.String"/>
	<parameter name="FECHA_EVENTO" class="java.lang.String"/>
	<parameter name="DESCRIPCION_EVENTO" class="java.lang.String"/>
	<parameter name="FOLIO" class="java.lang.String"/>
	<parameter name="TELEFONOS_CLIENTE" class="java.lang.String"/>
	<parameter name="FECHA_RECOLECCION" class="java.lang.String"/>
	<parameter name="COMENTARIO_EVENTO" class="java.lang.String"/>
	<parameter name="FECHA_ENTREGA" class="java.lang.String"/>
	<parameter name="NOMBRE_ATENDIO" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT * FROM(
SELECT
articulo.codigo AS codigo,
detalle_renta.cantidad AS cantidad,
CONCAT(articulo.descripcion," ",color.color) AS articulo,
categoria.descripcion AS categoria,
"" AS comentario,
articulo.image AS image_item
FROM detalle_renta AS detalle_renta
INNER JOIN articulo articulo ON (articulo.id_articulo = detalle_renta.id_articulo)
INNER JOIN categoria categoria ON (categoria.id_categoria = articulo.id_categoria)
INNER JOIN color color ON (color.id_color = articulo.id_color)
WHERE detalle_renta.id_renta = $P{RENTA_ID}
AND articulo.id_categoria IN (SELECT asigna.id_categoria FROM asigna_categoria asigna WHERE asigna.id_usuarios = $P{USUARIO_ID})
UNION
SELECT
CONCAT("* ",articulo_relation.codigo) AS codigo,
((
	SELECT detalle_renta.cantidad
	FROM detalle_renta detalle_renta
    WHERE detalle_renta.id_articulo = desglose_almacen.item_init_id
    AND detalle_renta.id_renta = $P{RENTA_ID}
)*desglose_almacen.amount) AS cantidad,
CONCAT(articulo_relation.descripcion," ",color_articulo_relation.color) AS articulo,
categoria_item_relation.descripcion AS categoria,
desglose_almacen.comment AS comentario,
articulo_relation.image AS image_item
FROM desglose_almacen desglose_almacen
INNER JOIN articulo articulo_relation ON (articulo_relation.id_articulo = desglose_almacen.item_relation_id)
INNER JOIN categoria categoria_item_relation ON (categoria_item_relation.id_categoria = articulo_relation.id_categoria)
INNER JOIN color color_articulo_relation ON (color_articulo_relation.id_color = articulo_relation.id_color)
WHERE desglose_almacen.item_init_id IN (
	SELECT detalle_renta.id_articulo
	FROM detalle_renta detalle_renta
    WHERE detalle_renta.id_renta = $P{RENTA_ID}
    )
AND articulo_relation.id_categoria IN (SELECT asigna.id_categoria FROM asigna_categoria asigna WHERE asigna.id_usuarios = $P{USUARIO_ID})
AND desglose_almacen.fg_active = 1
) a ORDER BY articulo]]>
	</queryString>
	<field name="codigo" class="java.lang.String"/>
	<field name="cantidad" class="java.lang.String"/>
	<field name="articulo" class="java.lang.String"/>
	<field name="categoria" class="java.lang.String"/>
	<field name="comentario" class="java.lang.String"/>
	<field name="image_item" class="java.io.InputStream"/>
	<pageHeader>
		<band height="150" splitType="Stretch">
			<staticText>
				<reportElement x="144" y="0" width="630" height="18" uuid="23c8cca1-e9ef-4a69-a481-61893aa571c2"/>
				<textElement>
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[REPORTE DE CATEGORIAS ASIGNADAS A UN USUARIO]]></text>
			</staticText>
			<textField>
				<reportElement x="144" y="18" width="327" height="20" uuid="71ffa44d-7262-4982-92cf-13ad411e7b82"/>
				<textElement>
					<font fontName="Arial" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["Encargado: "+$P{NOMBRE_ENCARGADO_AREA}]]></textFieldExpression>
			</textField>
			<image>
				<reportElement x="0" y="0" width="133" height="133" uuid="86ad3a50-98a2-4730-b487-a0d7b04e7db8"/>
				<imageExpression><![CDATA[$P{URL_IMAGEN}]]></imageExpression>
			</image>
			<textField>
				<reportElement x="473" y="18" width="329" height="20" uuid="9b2895fb-dcf3-48b4-bcdc-9b35f3e36f05"/>
				<textElement>
					<font fontName="Arial" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["Folio: "+$P{FOLIO}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="144" y="97" width="658" height="36" uuid="0cc079f5-9962-48d1-b99d-ad9c4b037d2c"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA["Lugar evento: "+$P{DESCRIPCION_EVENTO}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="144" y="38" width="327" height="20" uuid="b023467c-fe63-4821-aff2-2946e73f8253"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA["Cliente: "+$P{NOMBRE_CLIENTE}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="473" y="38" width="329" height="20" uuid="3007379f-f09b-473a-afd0-629455dec48e"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA["Telefono(s): "+$P{TELEFONOS_CLIENTE}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="144" y="78" width="327" height="17" uuid="e8591df2-10db-473e-9256-6c948ec39a6d"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA["Fecha entrega: "+$P{FECHA_ENTREGA}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="473" y="58" width="329" height="20" uuid="5f4e3376-f2a7-4bbb-b0f1-ba50164f748f"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA["Fecha evento: "+$P{FECHA_EVENTO}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="473" y="78" width="329" height="17" uuid="eeefa199-01eb-4b65-bf6b-d3a24ed2d416"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA["Fecha de recolección: "+$P{FECHA_RECOLECCION}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="1" y="133" width="602" height="17" forecolor="#666666" uuid="c61eb570-1bbd-4d12-a900-539eb7bbe41b"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<text><![CDATA[* Desglose de almacen por artículo]]></text>
			</staticText>
			<textField>
				<reportElement x="144" y="58" width="327" height="20" uuid="74c4ef3d-ab39-4f4f-af6c-7f95b9a88de7"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA["Atendió: "+$P{NOMBRE_ATENDIO}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="20" splitType="Stretch">
			<line>
				<reportElement x="0" y="1" width="802" height="1" forecolor="#CCCCCC" uuid="e569c120-dad5-47e3-86c1-8e1abc739aae"/>
			</line>
			<staticText>
				<reportElement x="0" y="5" width="58" height="15" uuid="526aaaf9-1e48-4709-af43-4d59724d970d"/>
				<textElement>
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Código]]></text>
			</staticText>
			<staticText>
				<reportElement x="66" y="5" width="31" height="15" uuid="ec014426-8c28-4565-8d4a-f50d1374d8d5"/>
				<textElement>
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Cant.]]></text>
			</staticText>
			<staticText>
				<reportElement x="144" y="5" width="571" height="15" uuid="e06300b8-7a5a-4733-b444-ae485aad9399"/>
				<textElement>
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Artículo]]></text>
			</staticText>
			<staticText>
				<reportElement x="715" y="5" width="87" height="15" uuid="af24c6d7-a4e5-4f22-bb3e-394594d9e57a"/>
				<textElement>
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Categoría]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="26" splitType="Stretch">
			<textField>
				<reportElement x="1" y="0" width="66" height="25" forecolor="#666666" uuid="5b85f887-ff8f-48fc-9ddc-43d94ab5cfa0"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{codigo}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="66" y="0" width="31" height="25" forecolor="#666666" uuid="75d628e6-7d5d-440d-a30c-61e5bf7a7477"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial" size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cantidad}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="144" y="0" width="571" height="25" forecolor="#666666" uuid="b5fee8cc-4877-4774-be5c-0d7839fdb486"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{articulo}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="715" y="0" width="87" height="25" forecolor="#666666" uuid="4159bc0e-93dd-42af-8a78-f89e1a2d366f"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{categoria}]]></textFieldExpression>
			</textField>
			<image scaleImage="FillFrame">
				<reportElement x="109" y="0" width="29" height="25" uuid="74a12a7b-319b-4021-8985-26950a343b7b"/>
				<imageExpression><![CDATA[$F{image_item}]]></imageExpression>
			</image>
		</band>
	</detail>
	<columnFooter>
		<band height="92" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="190" height="20" uuid="e4cd07fb-6f2b-4265-b352-134f93a7a49e"/>
				<textElement>
					<font fontName="Arial" size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[C O M E N T A R I O S :]]></text>
			</staticText>
			<textField>
				<reportElement x="0" y="20" width="802" height="72" uuid="74ae1d67-43f8-4cb3-9ac7-8aab2af00ec9"/>
				<textElement>
					<font fontName="Arial" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{COMENTARIO_EVENTO}]]></textFieldExpression>
			</textField>
		</band>
	</columnFooter>
	<pageFooter>
		<band height="24" splitType="Stretch">
			<textField>
				<reportElement x="0" y="0" width="80" height="20" uuid="e9b8ea04-e87d-4e8f-ab87-56e72c5e8782"/>
				<textElement textAlignment="Right">
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="80" y="0" width="40" height="20" uuid="f6aa0037-9348-4cb3-a273-2edc8eacc0c0"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="593" y="0" width="209" height="20" uuid="f4cb34b0-076f-4e8d-9c82-1240116a2134"/>
				<textElement>
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA["Fecha impresión: "+new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>
